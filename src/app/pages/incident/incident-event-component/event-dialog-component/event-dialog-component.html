<div class="drawer-wrapper">
    <header class="drawer-header">
        <div class="drawer-header-text">
            <h2 class="drawer-title">{{ isEdit ? 'Editar Evento' : 'Adicionar Novo Evento' }}</h2>
            <p class="drawer-subtitle">Preencha os detalhes do evento. Campos com * são obrigatórios.</p>
        </div>

        <button type="button" aria-label="Fechar" (click)="onCancel()" class="close-icon">
            <fa-icon [icon]="xmark" aria-hidden="true"></fa-icon>
        </button>
    </header>

    <form #eventForm="ngForm" class="drawer-form" (ngSubmit)="onSubmit(eventForm)">
        <div class="drawer-body">
            <mat-form-field appearance="fill" floatLabel="always" class="w-full event-datetime-field"
                            [ngClass]="{ 'has-error': eventAtModel.invalid && (eventAtModel.dirty || eventAtModel.touched) }">
                <mat-label>Data e Hora do Evento</mat-label>
                <input
                    matInput
                    #eventAtInput
                    id="eventAt"
                    name="eventAt"
                    type="text"
                    [(ngModel)]="event.eventAt"
                    placeholder="DD/MM/YYYY HH:mm:ss"
                    #eventAtModel="ngModel"
                    required>
                <button
                    mat-icon-button
                    matSuffix
                    type="button"
                    aria-label="Abrir calendário"
                    (click)="openCalendar()">
                    <fa-icon [icon]="calendarDay" aria-hidden="true"></fa-icon>
                </button>
                <mat-error *ngIf="eventAtModel.invalid && (eventAtModel.dirty || eventAtModel.touched)">
                    A data e hora do evento é obrigatória.
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" floatLabel="always" class="w-full spaced-field"
                            [ngClass]="{ 'has-error': typeModel.invalid && (typeModel.dirty || typeModel.touched) }">
                <mat-label>Tipo de Evento</mat-label>
                <mat-select id="type" name="type" [(ngModel)]="event.type" #typeModel="ngModel" required>
                    <mat-option value="">Selecione</mat-option>
                    <mat-option *ngFor="let type of eventTypes" [value]="type.id">{{ type.name }}</mat-option>
                </mat-select>
                <mat-error *ngIf="typeModel.invalid && (typeModel.dirty || typeModel.touched)">
                    O tipo de evento é obrigatório.
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" floatLabel="always" class="w-full spaced-field"
                            [ngClass]="{ 'has-error': descriptionModel.invalid && (descriptionModel.dirty || descriptionModel.touched) }">
                <mat-label>Descrição</mat-label>
                <textarea matInput id="description" name="description" [(ngModel)]="event.description"
                          #descriptionModel="ngModel" required maxlength="4000"
                          cdkTextareaAutosize cdkAutosizeMinRows="3" cdkAutosizeMaxRows="6"></textarea>
                <mat-hint align="end">{{ event.description.length || 0 }}/4000</mat-hint>
                <mat-error *ngIf="descriptionModel.invalid && (descriptionModel.dirty || descriptionModel.touched)">
                    A descrição é obrigatória.
                </mat-error>
            </mat-form-field>
        </div>

        <div class="drawer-actions">
            <button type="button" (click)="onCancel()" class="btn-secondary drawer-cancel-button">
                Cancelar
            </button>
            <button type="submit"
                    [disabled]="!isFormValid() || eventForm.invalid"
                    class="btn-primary drawer-primary-button">
                {{ isEdit ? 'Salvar Alterações' : 'Adicionar Evento' }}
            </button>
        </div>
    </form>
</div>
