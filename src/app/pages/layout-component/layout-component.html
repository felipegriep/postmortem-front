<div class="min-h-screen flex flex-col">
    <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Left: Brand only -->
                <div class="flex items-center gap-3">
                    <a class="flex items-center gap-2 text-xl font-bold text-gray-800 dark:text-white" routerLink="/">
                        <svg class="w-8 h-8 text-blue-600"
                             fill="none"
                             viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z"
                                  stroke="currentColor"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M12 12L22 7"
                                  stroke="currentColor"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M12 12V22"
                                  stroke="currentColor"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M12 12L2 7"
                                  stroke="currentColor"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"/>
                            <path d="M7 4.5L17 9.5"
                                  stroke="currentColor"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2"/>
                        </svg>
                        <span>Postmortem Hub</span>
                    </a>
                </div>

                <!-- Right: either Google sign-in (when NOT logged) OR hamburger+avatar (when logged) -->
                <div class="flex items-center space-x-4">
                    <!-- If NOT logged in: show Google sign-in -->
                    <div *ngIf="!isLoggedIn" class="google-signin-wrapper">
                        <div class="g_id_signin" data-size="large" data-type="standard"></div>
                    </div>

                    <!-- When logged in: show hamburger (at extreme right) and user avatar to its right -->
                    <div *ngIf="isLoggedIn" class="flex items-center gap-2">
                        <!-- hamburger first (to the left) -->
                        <button #hamburgerBtn (click)="toggleMenu()" [attr.aria-expanded]="isMenuOpen" aria-controls="app-sidebar" class="hamburger" aria-label="Abrir menu">
                            <svg class="w-6 h-6 text-gray-700 dark:text-gray-200" fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 6h16M4 12h16m-7 6h7"
                                      stroke-linecap="round"
                                      stroke-linejoin="round"
                                      stroke-width="2"></path>
                            </svg>
                        </button>

                        <!-- avatar to the right of hamburger -->
                        <ng-container *ngIf="user">
                            <img *ngIf="user.picture" [src]="user.picture" alt="UsuÃ¡rio" class="user-avatar"/>
                            <div *ngIf="!user.picture" class="user-avatar avatar-placeholder" [attr.aria-label]="user.name || user.email">
                                {{ getInitials(user.name || user.email) }}
                            </div>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar backdrop and panel (accessible). Backdrop shown only when open. Sidebar stays in DOM and uses .open class for visibility/animation -->
    <div *ngIf="isMenuOpen" class="sidebar-backdrop" (click)="closeMenu()" aria-hidden="true"></div>

    <aside #sidebar role="dialog" aria-modal="true" aria-label="Menu principal"
           id="app-sidebar"
           class="sidebar"
           [class.open]="isMenuOpen"
           [attr.aria-hidden]="!isMenuOpen"
           tabindex="-1">
        <div class="sidebar-header flex items-center gap-3 mb-6">
            <button (click)="closeMenu()" aria-label="Fechar menu" class="hamburger">
                <svg class="w-5 h-5 text-gray-700 dark:text-gray-200" fill="none" stroke="currentColor"
                     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                </svg>
            </button>
            <div *ngIf="user" class="flex items-center gap-3">
                <img *ngIf="user.picture" [src]="user.picture" alt="Avatar" class="user-avatar" />
                <div *ngIf="!user.picture" class="user-avatar avatar-placeholder">{{ getInitials(user.name || user.email) }}</div>
                <div>
                    <div class="font-semibold text-gray-800 dark:text-gray-100">{{user.name || user.email}}</div>
                    <div class="text-xs text-gray-500">{{user.email}}</div>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav space-y-3">
            <a routerLink="/incidents" (click)="closeMenu()" class="block py-2 px-3 nav-link">Incidentes</a>
            <a (click)="logout($event)" class="block py-2 px-3 nav-link" href="#">Logout</a>
        </nav>
    </aside>

    <main class="flex-grow container mx-auto p-4">
        <router-outlet></router-outlet>
    </main>
</div>
